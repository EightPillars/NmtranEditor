; Script generated by the pharmML2Nmtran Converter v.0.1.0
; Source	: PharmML 0.6.0
; Target	: NMTRAN 7.3.0
; Model 	: UseCase3
; Dated 	: Wed Aug 05 14:52:12 BST 2015

$PROBLEM "UseCase3.mdl - generated by MDL2PharmML v.6.0"

$INPUT  ID TIME WT AGE=DROP SEX=DROP AMT DVID DV MDV
$DATA "warfarin_conc_pca.csv" IGNORE=#
$SUBS ADVAN13 TOL=9

$MODEL 
COMP (COMP1) 	;GUT
COMP (COMP2) 	;CENTRAL
COMP (COMP3) 	;PCA

$PK 
POP_CL = THETA(1)
POP_V = THETA(2)
POP_TABS = THETA(3)
POP_TLAG = THETA(4)
POP_S0 = THETA(5)
POP_C50 = THETA(6)
POP_TEQ = THETA(7)
RUV_PROP = THETA(8)
RUV_ADD = THETA(9)
RUV_FX = THETA(10)
POP_EMAX = THETA(11)
BETA_CL_WT = THETA(12)
BETA_V_WT = THETA(13)

ETA_CL = ETA(1)
ETA_V = ETA(2)
ETA_TABS = ETA(3)
ETA_TLAG = ETA(4)
ETA_S0 = ETA(5)
ETA_EMAX = ETA(6)
ETA_C50 = ETA(7)
ETA_TEQ = ETA(8)

LOGTWT = LOG(WT/70)


MU_1 = LOG(POP_CL)+BETA_CL_WT * LOGTWT;
CL = EXP(MU_1 + ETA(1));

MU_2 = LOG(POP_V)+BETA_V_WT * LOGTWT;
V = EXP(MU_2 + ETA(2));

MU_3 = LOG(POP_TABS);
TABS = EXP(MU_3 + ETA(3));

MU_4 = LOG(POP_TLAG);
TLAG = EXP(MU_4 + ETA(4));

MU_5 = LOG(POP_S0);
S0 = EXP(MU_5 + ETA(5));

MU_6 = LOG(POP_EMAX);
EMAX = EXP(MU_6 + ETA(6));

MU_7 = LOG(POP_C50);
C50 = EXP(MU_7 + ETA(7));

MU_8 = LOG(POP_TEQ);
TEQ = EXP(MU_8 + ETA(8));

KA = LOG(2)/TABS ;
S2 = V ;
KPCA = LOG(2)/TEQ ;
RPCA = S0*KPCA ;
A_0(1) = 0
A_0(2) = 0
A_0(3) = S0

$DES 
GUT = A(1)
CENTRAL = A(2)
PCA = A(3)

IF (T.GE.TLAG) THEN
	RATEIN = KA*GUT 
ELSE
	RATEIN = 0 
ENDIF
 
CC_DES =  CENTRAL/V
DPCA = PCA
PD = (1+EMAX*CC/(C50+CC))
DADT(1) = -(RATEIN)
DADT(2) = (RATEIN-CL*CENTRAL/V)
DADT(3) = (RPCA*PD-KPCA*DPCA)

$ERROR 

IF(DVID.EQ.1) THEN
	CC =  A(2)/V

IPRED = CC
W = RUV_ADD+RUV_PROP*IPRED
Y = IPRED+W*EPS(1)
IRES = DV - IPRED
IWRES = IRES/W

ENDIF

IF(DVID.EQ.2) THEN
	IPRED = A(3)
W = RUV_FX
Y = IPRED+W*EPS(1)
IRES = DV - IPRED
IWRES = IRES/W

ENDIF

$THETA 
( 0.01 , 0.134 , 1.0 )	;POP_CL
( 0.01 , 8.1 , 20.0 )	;POP_V
( 0.01 , 0.575 , 24.0 )	;POP_TABS
( 0.01 , 0.815 , 24.0 )	;POP_TLAG
( 0.01 , 96.7 , 200.0 )	;POP_S0
( 0.01 , 1.2 , 10.0 )	;POP_C50
( 0.01 , 12.9 , 100.0 )	;POP_TEQ
(0.0133 )	;RUV_PROP
(0.05 )	;RUV_ADD
(15.3 )	;RUV_FX
(-1.0  FIX )	;POP_EMAX
(0.75  FIX )	;BETA_CL_WT
(1.0  FIX )	;BETA_V_WT

$OMEGA 
(0.0638 )	;PPV_CL
(0.0168 )	;PPV_V
(0.691 )	;PPV_TABS
(0.155 )	;PPV_LAG
(0.00377 )	;PPV_S0
(0.0  FIX )	;PPV_EMAX
(0.21 )	;PPV_C50
(0.0165 )	;PPV_TEQ

$SIGMA 
1.0 FIX
1.0 FIX

$EST METHOD=SAEM AUTO=1 PRINT=100


$TABLE  ID TIME WT AMT DVID MDV PRED IPRED RES IRES WRES IWRES Y DV NOAPPEND NOPRINT FILE=sdtab

$TABLE  ID CL V TABS TLAG S0 EMAX C50 TEQ KA S2 KPCA RPCA ETA_CL ETA_V ETA_TABS ETA_TLAG ETA_S0 ETA_EMAX ETA_C50 ETA_TEQ NOAPPEND NOPRINT FILE=patab

$TABLE  ID WT NOAPPEND NOPRINT FILE=cotab


